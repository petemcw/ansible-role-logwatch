---
# Defines tasks to install and configure Logwatch

- name: Gather OS specific varibles
  include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution }}-{{ ansible_distribution_major_version }}.yml"
    - "{{ ansible_distribution }}.yml"
    - "{{ ansible_os_family }}.yml"

- name: Check if Logwatch is already installed
  stat: >
    path="{{ logwatch_config_dir }}/logwatch.conf"
  register: logwatch_installed

- name: Update package cache if not yet installed
  apt: >
    update_cache=yes
  when: logwatch_installed.stat.exists == false

- name: Install packages
  apt: >
    pkg="{{ item }}"
    state=latest
  with_items: "{{ logwatch_packages }}"

- name: Write configuration templates
  template: >
    src=logwatch-conf.j2
    dest="{{ logwatch_config_dir }}/logwatch.conf"
    mode=0644 owner=root group=root
    backup=yes
